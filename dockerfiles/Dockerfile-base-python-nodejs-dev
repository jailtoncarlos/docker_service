ARG DEV_IMAGE=python-nodejs-base:latest
FROM ${DEV_IMAGE} AS app-dev

ARG WORK_DIR
ARG REQUIREMENTS_FILE
ARG USER_NAME

# Defina o usuário padrão para o container
USER $USER_NAME

# Definir o diretório de trabalho usando o argumento passado
# diretório padrão onde o CMD será executado
WORKDIR $WORK_DIR

# Adicionar os arquivos da aplicação
COPY . $WORK_DIR

# Install requirements
# --mount=type=cache,target=/root/.cache/pip é uma opção avançada do Docker,
# introduzida no BuildKit (um recurso mais recente do Docker para melhorar a
# eficiência da construção de imagens). Ela cria um cache temporário durante
# o processo de construção.
RUN --mount=type=cache,target=/root/.cache/pip pip install -r ${REQUIREMENTS_FILE}

# Instalar os hooks do pre-commit, caso exista o arquivo .pre-commit-config.yaml
RUN if [ -f .pre-commit-config.yaml ]; then pre-commit install --install-hooks; fi

CMD ["/bin/sh", "-c", "echo 'Starting dev container'; sleep infinity"]